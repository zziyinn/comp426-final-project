import{createRequest as e}from"@urql/core";export*from"@urql/core";import*as t from"react";import{toPromise as r,take as n,filter as a,onPush as u,subscribe as i,takeWhile as o,onEnd as s}from"wonka";var c=t.createContext({}),f=c.Provider,l=c.Consumer;c.displayName="UrqlContext";var v=()=>t.useContext(c),d={fetching:!1,stale:!1,hasNext:!1,error:void 0,data:void 0,extensions:void 0,operation:void 0},x=(e,t)=>e===t||!(!e||!t||e.key!==t.key),h=(e,t)=>{var r={...e,...t,data:void 0!==t.data||t.error?t.data:e.data,fetching:!!t.fetching,stale:!!t.stale};return((e,t)=>{for(var r in e)if(!(r in t))return!0;for(var n in t)if("operation"===n?!x(e[n],t[n]):e[n]!==t[n])return!0;return!1})(e,r)?r:e},p=(e,t)=>{for(var r=0,n=t.length;r<n;r++)if(e[r]!==t[r])return!0;return!1};function y(e,t){e(t)}function g(i){var o=t.useRef(!0),s=v(),[c,f]=t.useState(d),l=t.useCallback(((t,c)=>(y(f,{...d,fetching:!0}),r(n(1)(a((e=>!e.hasNext))(u((e=>{o.current&&y(f,{fetching:!1,stale:e.stale,data:e.data,error:e.error,extensions:e.extensions,operation:e.operation,hasNext:e.hasNext})}))(s.executeMutation(e(i,t),c||{}))))))),[s,i,f]);return t.useEffect((()=>(o.current=!0,()=>{o.current=!1})),[]),[c,l]}function k(r,n){var a=t.useRef(void 0);return t.useMemo((()=>{var t=e(r,n);return void 0!==a.current&&a.current.key===t.key?a.current:(a.current=t,t)}),[r,n])}var b=e=>{if(!e._react){var t=new Set,r=new Map;e.operations$&&i((e=>{"teardown"===e.kind&&t.has(e.key)&&(t.delete(e.key),r.delete(e.key))}))(e.operations$),e._react={get:e=>r.get(e),set(e,n){t.delete(e),r.set(e,n)},dispose(e){t.add(e)}}}return e._react},m=(e,t)=>t&&void 0!==t.suspense?!!t.suspense:e.suspense;function q(e){var r=v(),n=b(r),a=m(r,e.context),c=k(e.query,e.variables),f=t.useMemo((()=>{if(e.pause)return null;var t=r.executeQuery(c,{requestPolicy:e.requestPolicy,...e.context});return a?u((e=>{n.set(c.key,e)}))(t):t}),[n,r,c,a,e.pause,e.requestPolicy,e.context]),l=t.useCallback(((e,t)=>{if(!e)return{fetching:!1};var r=n.get(c.key);if(r){if(t&&null!=r&&"then"in r)throw r}else{var a,u=i((e=>{r=e,a&&a(r)}))(o((()=>t&&!a||!r||"hasNext"in r&&r.hasNext))(e));if(null==r&&t){var s=new Promise((e=>{a=e}));throw n.set(c.key,s),s}u.unsubscribe()}return r||{fetching:!0}}),[n,c]),x=[r,c,e.requestPolicy,e.context,e.pause],[g,q]=t.useState((()=>[f,h(d,l(f,a)),x])),P=g[1];f!==g[0]&&p(g[2],x)&&q([f,P=h(g[1],l(f,a)),x]),t.useEffect((()=>{var e=g[0],t=g[2][1],r=!1,a=e=>{r=!0,y(q,(t=>{var r=h(t[1],e);return t[1]!==r?[t[0],r,t[2]]:t}))};if(e){var u=i(a)(s((()=>{a({fetching:!1})}))(e));return r||a({fetching:!0}),()=>{n.dispose(t.key),u.unsubscribe()}}a({fetching:!1})}),[n,g[0],g[2][1]]);var C=t.useCallback((t=>{var i={requestPolicy:e.requestPolicy,...e.context,...t};y(q,(e=>[a?u((e=>{n.set(c.key,e)}))(r.executeQuery(c,i)):r.executeQuery(c,i),e[1],x]))}),[r,n,c,a,e.requestPolicy,e.context,e.pause]);return[P,C]}function P(e,r){var n=v(),a=k(e.query,e.variables),u=t.useRef(r);u.current=r;var o=t.useMemo((()=>e.pause?null:n.executeSubscription(a,e.context)),[n,a,e.pause,e.context]),c=[n,a,e.context,e.pause],[f,l]=t.useState((()=>[o,{...d,fetching:!!o},c])),x=f[1];o!==f[0]&&p(f[2],c)&&l([o,x=h(f[1],{fetching:!!o}),c]),t.useEffect((()=>{var e=e=>{y(l,(t=>{var r=h(t[1],e);return t[1]===r?t:(u.current&&null!=r.data&&t[1].data!==r.data&&(r.data=u.current(t[1].data,r.data)),[t[0],r,t[2]])}))};if(f[0])return i(e)(s((()=>{e({fetching:!!o})}))(f[0])).unsubscribe;e({fetching:!1})}),[f[0]]);var g=t.useCallback((t=>{var r=n.executeSubscription(a,{...e.context,...t});y(l,(e=>[r,e[1],c]))}),[n,a,e.context,e.pause]);return[x,g]}function C(e){var t=g(e.query);return e.children({...t[0],executeMutation:t[1]})}function w(e){var t=q(e);return e.children({...t[0],executeQuery:t[1]})}function N(e){var t=P(e,e.handler);return e.children({...t[0],executeSubscription:t[1]})}export{l as Consumer,c as Context,C as Mutation,f as Provider,w as Query,N as Subscription,v as useClient,g as useMutation,q as useQuery,P as useSubscription};
//# sourceMappingURL=urql.min.es.js.map
